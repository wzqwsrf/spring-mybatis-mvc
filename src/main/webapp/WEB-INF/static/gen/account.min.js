var _ACCOUNT_DETAILS_GROUP_TIP="工程师权限 -> qunarengineer<br/>自助发布权限 -> qunardep<br/>sudo权限 -> qunarpe<br/>";var _ACCOUNT_GROUP_TIP=_ACCOUNT_DETAILS_GROUP_TIP;var _ACCOUNT_DETAILS_CUR_PROCESS_TIP="当前审批阶段<br/>BU Leader -> 应用负责人<br/>Sec Leader -> 安全负责人<br/>OPS Leader -> OPS负责人<br/>DBA Leader -> DBA负责人<br/></br>请联系下面 &quot;审批人列表&quot; 中的人员进行审批<br/>* 注意:<br/>OPS负责人请联系: hongtao.miao & jihua.cai<br/>安全负责人请联系: tiansen.guo & qiang.guo";var _ACCOUNT_DETAILS_LEADER_LIST_TIP="当前环节可以审批的负责人列表:<br/>OPS负责人请联系: hongtao.miao & jihua.cai<br/>安全负责人请联系: tiansen.guo & qiang.guo";function mapGroupToChinese(a){if(a=="qunarengineer"){return"工程师权限"}else{if(a=="qunarpe"){return"sudo权限"}else{if(a=="qunardep"){return"自助发布权限"}else{if(a=="qunarops"){return"OPS权限"}else{return"未知权限"}}}}}function mapChineseToGroup(a){if(a=="工程师权限"){return"qunarengineer"}else{if(a=="sudo权限"){return"qunarpe"}else{if(a=="自助发布权限"){return"qunardep"}else{if(a=="OPS权限"){return"qunarops"}else{return"unknown"}}}}}String.format=function(b){if(arguments.length==0){return null}var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})};function setToolTip(a,b){$(function(){a.tooltip({position:{my:"center bottom-20",at:"center top",using:function(c,d){$(this).css(c);$("<div>").addClass("arrow").addClass(d.vertical).addClass(d.horizontal).appendTo(this)}},content:function(){return $(this).prop("title")},hide:{duration:b}})})}jQuery(function(a){window.colorbox_params={reposition:true,scalePhotos:true,scrolling:false,previous:'<i class="icon-arrow-left"></i>',next:'<i class="icon-arrow-right"></i>',close:"&times;",current:"{current} of {total}",maxWidth:"100%",maxHeight:"100%",onOpen:function(){document.body.style.overflow="hidden"},onClosed:function(){document.body.style.overflow="auto"},onComplete:function(){a.colorbox.resize()}};reloadUnfinishedApplicationTable();setToolTip(a(document),1500);a("#unfinished-application-tab").on("click",function(){reloadUnfinishedApplicationTable();showUnfinishedApplicationDetailsList()});a("#history-application-tab").on("click",function(){reloadHistoryApplicationTable();showHistoryApplicationDetailsList()});a("#user-hostlist-tab").on("click",function(){reloadUserHostListTable();showHostInfo()})});function showHostInfo(a){if(a==undefined||a==""){$("#host-info").html("");return}$.ajax({dataType:"json",url:"host/details?hostname="+a,type:"GET",success:function(f){if(f.success){if(f.data.length!=0){try{var c=f.data;var b="";b+=__generateDetailHtml("主机名","icon-desktop",c.hostname);b+=__generateDetailHtml("IP","icon-bolt",c.hostip);b+=__generateDetailHtml("用途","icon-cogs",c.usage);b+=__generateDetailHtml("操作系统类型","icon-laptop",c.os_name);b+=__generateDetailHtml("类型","icon-cloud",c.type);$("#host-info").html(b)}catch(d){}}else{$("#host-info").html("无详细信息")}}else{$("#host-info").html(f.msg)}},error:function(b,d,c){showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})}function loadUserHostListTable(){$("#account-page").mask("加载中...");var a=$("#user-hostlist-table").dataTable({bFilter:true,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"所有"]],iDisplayLength:50,bAutoWidth:false,bProcessing:true,bServerSide:false,bInfo:true,bSort:true,aoColumns:[{sTitle:'<li class="icon-desktop"></li> 主机名'},{sTitle:'<span title="'+_ACCOUNT_GROUP_TIP+'"><li class="icon-group"></li> 隶属组</span>'}],aaSorting:[[0,"asc"]],sAjaxSource:"user/hosts",fnServerData:function(b,d,c){$.ajax({dataType:"json",url:b,type:"GET",success:function(k){if(k.success){var h=k.data.length!=0?k.data:{aaData:[]};for(var g=0,e=h.aaData.length;g<e;++g){for(var f=0;f<h.aaData[g][1].length;++f){h.aaData[g][1][f]=mapGroupToChinese(h.aaData[g][1][f])}}c(h)}else{c({aaData:[]});showCommonNoticeDialog("获取我的主机列表失败","icon-warning-sign",generateNoticeMsg(k.msg),300)}$("#account-page").unmask()},error:function(e,g,f){$("#account-page").unmask();showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})},fnInitComplete:function(){var b=document.createElement("div");b.id="user-hostlist-table-height-limter";$("#user-hostlist-table").wrap(b);$.setObjectFull($("#user-hostlist-table-height-limter"),200,9,0)},fnDrawCallback:function(){$("#user-hostlist-table tbody tr").unbind("click");$("#user-hostlist-table tbody tr").on("click",function(f){try{var c;var b=$("td",this);var d=$(b[0]).text();showHostInfo(d)}catch(f){}}).on("dblclick",function(b){b.preventDefault()})}});addHelpLinkToTab()}function reloadUserHostListTable(){var a=document.getElementById("user-hostlist-table");if($.fn.dataTable.fnIsDataTable(a)){$(a).dataTable().fnDestroy()}loadUserHostListTable()}function loadUnfinishedApplicationTable(){$("#account-page").mask("加载中...");var a=$("#unfinished-application-table").dataTable({bFilter:false,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"所有"]],iDisplayLength:50,bAutoWidth:false,bProcessing:true,bServerSide:false,bInfo:true,bSort:true,aoColumns:[{sTitle:'<input id="unfinished-application-table-select-all" type="checkbox" value="ALL">',sWidth:"30px",bSortable:false},{sTitle:'<li class="icon-key"></li> ID',sWidth:"75px"},{sTitle:'<li class="icon-desktop"></li> 主机名'},{sTitle:'<span title="'+_ACCOUNT_GROUP_TIP+'"><li class="icon-group"></li> 隶属组</span>',sWidth:"150px"},{sTitle:'<li class="icon-legal"></li> 查看流程',sWidth:"120px"}],aaSorting:[[1,"desc"]],aoColumnDefs:[{fnRender:function(b){return'<input type="checkbox" value="'+b.aData[1]+'">'},aTargets:[0]}],sAjaxSource:"user/application/unfinished",fnServerData:function(b,d,c){$.ajax({dataType:"json",url:b,type:"GET",success:function(h){if(h.success){var g=h.data.length!=0?h.data:{aaData:[]};for(var f=0,e=g.aaData.length;f<e;++f){g.aaData[f][3]=mapGroupToChinese(g.aaData[f][3])}c(g)}else{c({aaData:[]});showCommonNoticeDialog("获取正在审批列表失败","icon-warning-sign",generateNoticeMsg(h.msg),300)}$("#account-page").unmask()},error:function(e,g,f){$("#account-page").unmask();showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})},fnInitComplete:function(){var b=document.createElement("div");b.id="unfinished-application-table-height-limter";$("#unfinished-application-table").wrap(b);$.setObjectFull($("#unfinished-application-table-height-limter"),200,9,0)},fnDrawCallback:function(){$("#unfinished-application-table").find('[data-rel="colorbox"]').colorbox(colorbox_params);setToolTip($("#unfinished-application-table tbody tr"),100);$("#unfinished-application-table tbody tr").attr("title","点击可以在右侧查看详细信息<br/>请根据 &quot;当前审批状态&quot; 及 &quot;审批人列表&quot; 联系相关人员进行审批");$("#unfinished-application-table tbody tr").unbind("click");$("#unfinished-application-table tbody tr").on("click",function(d){try{var c;var b=$("td",this);var f=$(b[1]).text();showUnfinishedApplicationDetailsList(f)}catch(d){}}).on("dblclick",function(b){b.preventDefault()});$("#unfinished-application-table-select-all").unbind("click");$("#unfinished-application-table-select-all").on("click",function(){$("input",a.fnGetNodes()).prop("checked",this.checked);$("input",a.fnGetNodes()).attr("checked",this.checked)}).on("dblclick",function(b){b.preventDefault()});$("#account-passphrase").unbind("click");$("#account-passphrase").on("click",function(){accountPasshrase(a)}).on("dblclick",function(b){b.preventDefault()});$("#account-application").unbind("click");$("#account-application").on("click",function(){accountApplication(a)}).on("dblclick",function(b){b.preventDefault()});$("#cancel-application").unbind("click");$("#cancel-application").on("click",function(){cancelApplication(a)}).on("dblclick",function(b){b.preventDefault()})}});$("#unfinished-application-table_wrapper > div:nth-child(1) > div:nth-child(2)").html('<button id="account-passphrase" class="btn btn-xs btn-info" style="float: right;">获取Passphrase</button><button id="account-application" class="btn btn-xs btn-primary" style="float: right">申请帐号</button><button id="cancel-application" class="btn btn-xs btn-info" style="float: right" title="只要申请流程没有审批完成，就可以撤销">撤销申请</button>');addHelpLinkToTab();$(("#account-passphrase")).attr("title","系统会自动创建一个密码复杂程度很高的passphrase，同时在跳板机增加你的登录帐号，你需要用RSA Token来登录跳板机，然后用passphrase登录其他服务器，且不能跨机房登录<br/><a href='http://wiki.corp.qunar.com/pages/viewpage.action?pageId=41782048' target='_blank'>工程师与ssh帐号</a><br/><a href='http://wiki.corp.qunar.com/pages/viewpage.action?pageId=41782048#%E5%B7%A5%E7%A8%8B%E5%B8%88%E4%B8%8Essh%E5%B8%90%E5%8F%B7-%E8%B7%B3%E6%9D%BF%E6%9C%BA%E5%88%97%E8%A1%A8' target='_blank'>跳板机列表</a>");$(("#account-application")).attr("title","<a href='http://wiki.corp.qunar.com/pages/viewpage.action?pageId=52069490#QunarOperation-%E5%B8%90%E5%8F%B7%E7%94%B3%E8%AF%B7-%E5%B8%90%E5%8F%B7%E7%94%B3%E8%AF%B7' target='blank'>如何申请帐号</a><br/><a href='http://wiki.corp.qunar.com/pages/viewpage.action?pageId=41782048' target='_blank'>工程师与ssh帐号</a><br/><a href='http://wiki.corp.qunar.com/pages/viewpage.action?pageId=41782048#%E5%B7%A5%E7%A8%8B%E5%B8%88%E4%B8%8Essh%E5%B8%90%E5%8F%B7-%E8%B7%B3%E6%9D%BF%E6%9C%BA%E5%88%97%E8%A1%A8' target='_blank'>跳板机列表</a>")}function addHelpLinkToTab(){var a=$("#application-tab").html();if(a.indexOf("<a href=")>0){return}a+='<div style="float: right; color: green; padding-right: 20px"><i class="icon-question"></i>&nbsp;<a href="http://wiki.corp.qunar.com/pages/viewpage.action?pageId=52069490" target="_blank">help</a></div>';$("#application-tab").html(a)}function loadHistoryApplicationTable(){$("#account-page").mask("加载中...");var a=$("#history-application-table").dataTable({bFilter:true,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"所有"]],iDisplayLength:50,bAutoWidth:false,bProcessing:false,bServerSide:false,bMutiSelect:false,bInfo:true,bSort:true,aoColumns:[{sTitle:"ID",sWidth:"50px"},{sTitle:"主机名"},{sTitle:"隶属组",sWidth:"150px"},{sTitle:"申请时间",sWidth:"100px"},{sTitle:"审批结果",sWidth:"200px"},{sTitle:"查看流程",sWidth:"120px"}],aaSorting:[[0,"desc"]],sAjaxSource:"",fnServerData:function(b,d,c){$.ajax({dataType:"json",url:"user/application/history",type:"POST",success:function(h){if(h.success){var g=h.data.length!=0?h.data:{aaData:[]};for(var f=0,e=g.aaData.length;f<e;++f){g.aaData[f][2]=mapGroupToChinese(g.aaData[f][2])}c(g)}else{c({aaData:[]});showCommonNoticeDialog("获取历史审批列表失败","icon-warning-sign",generateNoticeMsg(h.msg),300)}$("#account-page").unmask()},error:function(e,g,f){$("#account-page").unmask();showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})},fnInitComplete:function(){var b=document.createElement("div");b.id="history-application-table-height-limter";$("#history-application-table").wrap(b);$.setObjectFull($("#history-application-table-height-limter"),200,9,0)},fnDrawCallback:function(){$("#history-application-table").find('[data-rel="colorbox"]').colorbox(colorbox_params);$("#history-application-table_filter").attr("title","直接输入关键字进行查询");$("#history-application-table tbody tr").unbind("click");$("#history-application-table tbody tr").on("click",function(d){try{var c;var b=$("td",this);var f=$(b[0]).text();if($(this).hasClass("row_selected")){$(this).removeClass("row_selected")}else{a.$("tr.row_selected").removeClass("row_selected");$(this).addClass("row_selected")}showHistoryApplicationDetailsList(f)}catch(d){}}).on("dblclick",function(b){b.preventDefault()})},fnRowCallback:function(d,c,b){try{state=c[4];if(state=="同意"){$("td:eq(4)",d).html('<span class="label label-success arrowed-in-right arrowed">'+state+"</span>")}else{if(state=="拒绝"){$("td:eq(4)",d).html('<span class="label label-inverse arrowed-in-right arrowed">'+state+"</span>")}else{$("td:eq(4)",d).html('<span class="label label-info arrowed-in-right arrowed">'+state+"</span>")}}}catch(f){}}});addHelpLinkToTab()}function __generateLIHeader(c,a,b){return String.format('<li class="{0}" style="color: #307ecc; padding-bottom: 10px;" title="{1}"> {2}</li>',a,b,c)}function __generateLIData(b,a){return String.format('<li title="{0}">{1}</li>',a,b)}function __generateDetailHtml(g,e,b,a,f){var d='<ul class="list-unstyled spaced0">';var a=arguments[3]!=undefined?arguments[3]:true;var f=arguments[4]!=undefined?arguments[4]:"";d+=__generateLIHeader(g,e,f);for(var c=0;c<b.length;c++){d+=__generateLIData(b[c],f)}d+="</ul>";if(a){d+='<hr style="margin: 0px 0px 10px 0px;">'}return d}function showUnfinishedApplicationDetailsList(a){if(a==undefined||a==""){$("#unfinished-application-details-list").html("");return}$.ajax({dataType:"json",url:"approve/details?id="+a,type:"GET",success:function(f){if(f.success){if(f.data.length!=0){try{var c=f.data;var b="";b+=__generateDetailHtml("主机名","icon-desktop",c.hostname,true);b+=__generateDetailHtml("隶属组","icon-group",c.group,true,_ACCOUNT_DETAILS_GROUP_TIP);b+=__generateDetailHtml("当前审批状态","icon-eye-open",c.current_state,true,_ACCOUNT_DETAILS_CUR_PROCESS_TIP);b+=__generateDetailHtml("审批人列表","icon-group",c.approver_list,true,_ACCOUNT_DETAILS_LEADER_LIST_TIP);b+=__generateDetailHtml("审批历史","icon-book",c.approve_hisroty,true);b+=__generateDetailHtml("申请理由","icon-comment-alt",c.msg);b+=__generateDetailHtml("申请时间","icon-calendar",c.approve_time,false);$("#unfinished-application-details-list").html(b)}catch(d){}}else{$("#unfinished-application-details-list").html("无详细信息")}}else{$("#unfinished-application-details-list").html(f.msg)}},error:function(b,d,c){showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})}function showHistoryApplicationDetailsList(a){if(a==undefined||a==""){$("#history-application-details-list").html("");return}$.ajax({dataType:"json",url:"approve/details?id="+a,type:"GET",success:function(f){if(f.success){if(f.data.length!=0){try{var c=f.data;var b="";b+=__generateDetailHtml("主机名","icon-desktop",c.hostname,false,"主机名");b+=__generateDetailHtml("隶属组","icon-group",c.group,true,_ACCOUNT_DETAILS_GROUP_TIP);b+=__generateDetailHtml("当前审批状态","icon-eye-open",c.current_state,true,_ACCOUNT_DETAILS_CUR_PROCESS_TIP);b+=__generateDetailHtml("审批人列表","icon-group",c.approver_list,true,_ACCOUNT_DETAILS_LEADER_LIST_TIP);b+=__generateDetailHtml("审批历史","icon-book",c.approve_hisroty);b+=__generateDetailHtml("申请理由","icon-comment-alt",c.msg);b+=__generateDetailHtml("申请时间","icon-calendar",c.approve_time,false);$("#history-application-details-list").html(b);$("#history-application-details-list").find('[data-rel="colorbox"]').colorbox(colorbox_params)}catch(d){}}else{$("#history-application-details-list").html("无详细信息")}}else{$("#history-application-details-list").html(f.msg)}},error:function(b,d,c){showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})}function enableAccountApplicationDialogButton(a){if(a){$("#account-application-submit").removeAttr("disabled");$("#account-application-cancel").removeAttr("disabled")}else{$("#account-application-submit").attr("disabled","true");$("#account-application-cancel").attr("disabled","true")}}function enableAccountApplicationToolbarButton(a){if(a){$("#account-passphrase").removeAttr("disabled");$("#account-application").removeAttr("disabled");$("#cancel-application").removeAttr("disabled")}else{$("#account-passphrase").attr("disabled","true");$("#cancel-application").attr("disabled","true")}}function accountPasshrase(a){$.ajax({dataType:"json",url:"user/passphrase",type:"GET",success:function(b){if(b.success){showCommonNoticeDialog("passphrase","icon-info-sign",generateNoticeMsg(b.data),300)}else{showCommonNoticeDialog("获取passphrase失败","icon-warning-sign",generateNoticeMsg(b.msg),300)}},error:function(b,d,c){showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})}function accountApplication(a){try{$.widget("ui.dialog",$.extend({},$.ui.dialog.prototype,{_title:function(e){var d=this.options.title||"&nbsp;";if(("title_html" in this.options)&&(this.options.title_html==true)){e.html(d)}else{e.text(d)}}}));dialog_width=Math.min(Math.round(window.screen.width*0.7),900);dialog_height=Math.min(Math.round(window.screen.height*0.7),600);$("#account-application-dialog").empty();$("#account-application-dialog").append(createAccountApplicationForm(dialog_height-50));$("#group-list").chosen({width:"200px",disable_search_threshold:10});var b=$("#account-application-dialog").removeClass("hide").dialog({modal:true,width:dialog_width,height:dialog_height,title:'<div style="color: DodgerBlue; padding: 4px; height: 28px; font-size: 14px; font-weight: bold"><li class="icon-user"></li> 申请帐号</div>',title_html:true,closeOnEscape:false,open:function(d,e){$("#application-form-group-list-tip").attr("title",_ACCOUNT_GROUP_TIP);$("#group_list_chosen").attr("title",_ACCOUNT_GROUP_TIP);$(".ui-dialog-titlebar-close").hide()},buttons:[{id:"account-application-submit",text:"提交","class":"btn btn-primary btn-xs",click:function(j){$("#account-application-dialog").mask("加载中...");var h=this;enableAccountApplicationDialogButton(false);try{var f=$("#account-application-dialog").find("form");var d=f.serializeArray();for(var g in d){if(d[g]["name"]=="hostlist"){if(d[g]["value"].length==0){$("#account-application-dialog").unmask();enableAccountApplicationDialogButton(true);showCommonNoticeDialog("主机名错误","icon-warning-sign",generateNoticeMsg("主机名不能为空"),300);return}}else{if(d[g]["name"]=="msg"){if(d[g]["value"].length>=100){$("#account-application-dialog").unmask();enableAccountApplicationDialogButton(true);showCommonNoticeDialog("申请理由错误","icon-warning-sign",generateNoticeMsg("申请理由不能超过100个字符"),300);return}}}}$.ajax({url:"user/application",type:"POST",data:d,dataType:"json",success:function(m,n,k){try{enableAccountApplicationDialogButton(true);$("#account-application-dialog").unmask();if(m.success){title_html_str='<div class="dialog_title"><li class="icon-info-sign"></li> 申请账号</div>';$("#account-application-result-dialog").append(generateNoticeMsg("创建申请成功"))}else{title_html_str='<div class="dialog_title"><li class="icon-exclamation-sign"></li> 申请帐号</div>';$("#account-application-result-dialog").append(generateNoticeMsg(m.msg))}}catch(l){}var i=$("#account-application-result-dialog").removeClass("hide").dialog({modal:true,width:400,resizable:true,title:title_html_str,title_html:true,closeOnEscape:false,buttons:[{text:"确定","class":"btn btn-primary btn-xs",click:function(){$("#account-application-result-dialog").empty();$("#account-application-result-dialog").dialog("destroy");reloadUnfinishedApplicationTable();if(m.success){$(h).dialog("close")}}}],close:function(){$("#account-application-result-dialog").empty();$("#account-application-result-dialog").dialog("destroy")}})},error:function(e,k,i){$("#account-application-dialog").unmask();enableAccountApplicationDialogButton(true);showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}});j.preventDefault()}catch(j){$("#account-application-dialog").unmask();enableAccountApplicationDialogButton(true);showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}}},{id:"account-application-cancel",text:"取消","class":"btn btn-xs",click:function(){$(this).dialog("close")}}]})}catch(c){enableAccountApplicationDialogButton(true);showCommonNoticeDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}}function createAccountApplicationForm(b){var c='<form style="width: 100%; background-color: white"> ';c+="<div>";c+='<label><li class="icon-desktop"></li> 主机列表：</label>';var a="Tips: 可使用范围表达式 l-cloud[1-8].ops.cn1 多组主机之间使用换行分割(.qunar.com可以省略)";c+=String.format('<textarea id="hostlist-textarea" class="form-control" name="hostlist" style="height: {0}px;" placeholder="{1}"></textarea>',b/7*3,a);c+="</div>";c+="<hr>";c+='<div><label id="application-form-group-list-tip"><li class="icon-group"></li> 隶属组：</label><select id="group-list" name="group" class="chosen-select level-list-select" data-placeholder="隶属组">';c+='<option value="qunarengineer">工程师权限</option>';c+='<option value="qunardep">自助发布权限</option>';c+='<option value="qunarpe">sudo权限</option>';c+="</select>";c+="</div>";c+="<hr>";c+="<div>";c+='<label><li class="icon-comments"></li> 申请理由：</label>';a="Tips: 申请理由请不要超过100个字符";c+=String.format('<textarea class="form-control" name="msg" style="height: {0}px;" placeholder="{1}"></textarea>',b/7,a);c+="</div>";c+="</form>";return c}function cancelApplication(a){try{enableAccountApplicationToolbarButton(false);var c=new Array();$("input:checked",a.fnGetNodes()).each(function(){c.push($(this).val())});var f={bpm_ids:c.join(",")};if(c.length<1){enableAccountApplicationToolbarButton(true);showCancelApplicationResultDialog("撤销申请","icon-lightbulb",generateNoticeMsg("请选择要撤销申请的条目!"),300);return}$("#cancel-application-confirm-dialog").append('<div class="alert alert-info bigger-110">确认撤销申请？</div>');title_html_str='<div class="dialog_title"><li class="icon-lightbulb"></li> 撤销申请</div>';var b=$("#cancel-application-confirm-dialog").removeClass("hide").dialog({modal:true,width:300,resizable:true,title:title_html_str,title_html:true,buttons:[{text:"提交","class":"btn btn-danger btn-xs",click:function(){$("#account-page").mask("加载中...");$("#cancel-application-confirm-dialog").empty();$("#cancel-application-confirm-dialog").dialog("destroy");__cancelReuqest(a,f)}},{text:"取消","class":"btn btn-primary btn-xs",click:function(){$("#cancel-application-confirm-dialog").empty();$("#cancel-application-confirm-dialog").dialog("destroy");enableAccountApplicationToolbarButton(true)}}],close:function(){$("#cancel-application-confirm-dialog").empty();$("#cancel-application-confirm-dialog").dialog("destroy");enableAccountApplicationToolbarButton(true)}})}catch(d){}}function __cancelReuqest(a,b){$.ajax({datatype:"json",url:"user/application/cancel",type:"post",data:b,success:function(g){var h="";try{if(g.success){h='<div class="dialog_title"><li class="icon-info-sign"></li> 撤销申请</div>';var f=g.data.succeed;var c=g.data.failed;if(c.length!=0){var k='<b style="color: red;"><li class="icon-ban-circle"></li> 撤销失败:</b><br/>';for(var j=0;j<c.length;j++){k+="&nbsp;&nbsp;&nbsp;&nbsp;"+c[j]+"<br/>"}$("#cancel-application-result-dialog").append(generateNoticeMsg(k))}else{var d='<b><li class="icon-check"></li> 撤销成功</b><br/>';$("#cancel-application-result-dialog").append(generateNoticeMsg(d))}}else{h='<div class="dialog_title"><li class="icon-exclamation-sign"></li> 撤销申请</div>';$("#cancel-application-result-dialog").append(generateNoticeMsg(g.msg))}}catch(l){}$("#account-page").unmask();var n=$("#cancel-application-result-dialog").removeClass("hide").dialog({modal:true,width:400,resizable:true,title:h,title_html:true,closeOnEscape:false,buttons:[{text:"确定","class":"btn btn-primary btn-xs",click:function(){$("#cancel-application-result-dialog").empty();$("#cancel-application-result-dialog").dialog("destroy");enableAccountApplicationToolbarButton(true)}}],close:function(){$("#cancel-application-result-dialog").empty();$("#cancel-application-result-dialog").dialog("destroy");enableAccountApplicationToolbarButton(true)}});var m=document.getElementById("unfinished-application-table");if($.fn.dataTable.fnIsDataTable(m)){$(m).dataTable().fnDestroy()}loadUnfinishedApplicationTable()},error:function(e,c,d){$("#account-page").unmask();enableAccountApplicationToolbarButton(true);showCancelApplicationResultDialog("网络错误","icon-warning-sign",generateNoticeMsg("网络错误，请刷新后重试!"),300)}})}function generateNoticeMsg(a){return String.format('<div class="alert alert-info bigger-110" style="margin-bottom: 0px; margin-top: 5px;">{0}</div>',a)}function reloadUnfinishedApplicationTable(){var a=document.getElementById("unfinished-application-table");if($.fn.dataTable.fnIsDataTable(a)){$(a).dataTable().fnDestroy()}loadUnfinishedApplicationTable()}function reloadHistoryApplicationTable(){var a=document.getElementById("history-application-table");if($.fn.dataTable.fnIsDataTable(a)){$(a).dataTable().fnDestroy()}loadHistoryApplicationTable()}function showCancelApplicationResultDialog(e,c,d,b){$("#cancel-application-result-dialog").append(d);title_html_str=String.format('<div class="dialog_title"><li class="{0}"></li> {1}</div>',c,e);var a=$("#cancel-application-result-dialog").removeClass("hide").dialog({modal:true,width:b,resizable:true,title:title_html_str,title_html:true,closeOnEscape:false,open:function(f,g){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"确定","class":"btn btn-primary btn-xs",click:function(){$("#cancel-application-result-dialog").empty();$("#cancel-application-result-dialog").dialog("destroy")}}],close:function(){$("#cancel-application-result-dialog").empty();$("#cancel-application-result-dialog").dialog("destroy")}})}function showCommonNoticeDialog(e,c,d,b){$("#common-notice-dialog").append(d);title_html_str=String.format('<div class="dialog_title"><li class="{0}"></li> {1}</div>',c,e);var a=$("#common-notice-dialog").removeClass("hide").dialog({modal:true,width:b,resizable:true,title:title_html_str,title_html:true,closeOnEscape:false,open:function(f,g){$(".ui-dialog-titlebar-close").hide()},buttons:[{text:"确定","class":"btn btn-primary btn-xs",click:function(){$("#common-notice-dialog").empty();$("#common-notice-dialog").dialog("destroy")}}],close:function(){$("#common-notice-dialog").empty();$("#common-notice-dialog").dialog("destroy")}});$(a).parent().find("a.ui-dialog-titlebar-close").remove()};